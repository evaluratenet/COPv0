# 🚀 Render Deployment Guide - Circle of Peers

This guide will help you deploy the Circle of Peers platform to Render using GitHub integration for automatic deployments.

## 🎯 Why Render + GitHub?

### Benefits
- **Automatic Deployments**: Push to GitHub → Auto-deploy to Render
- **Version Control**: Full Git history and rollback capabilities
- **Environment Management**: Separate staging and production environments
- **Built-in Services**: PostgreSQL, Redis, and monitoring included
- **SSL/TLS**: Automatic HTTPS certificates
- **Scaling**: Easy horizontal and vertical scaling
- **Monitoring**: Built-in logs and metrics

### Architecture
```
GitHub Repository
       ↓
   Render Services
       ↓
┌─────────────────┐
│   Discourse     │ ← Main forum platform
├─────────────────┤
│   AI Service    │ ← Content moderation
├─────────────────┤
│ Landing Page    │ ← Marketing site
├─────────────────┤
│   PostgreSQL    │ ← Database
├─────────────────┤
│     Redis       │ ← Cache
└─────────────────┘
```

## 📋 Prerequisites

1. **GitHub Account** with repository access
2. **Render Account** (free tier available)
3. **Domain Name** (optional, for custom domain)
4. **API Keys**:
   - OpenAI API key
   - Discourse API key
   - SMTP credentials

## 🚀 Step-by-Step Deployment

### Step 1: Prepare GitHub Repository

1. **Push your code to GitHub**:
   ```bash
   git init
   git add .
   git commit -m "Initial Circle of Peers platform"
   git branch -M main
   git remote add origin https://github.com/yourusername/circle-of-peers.git
   git push -u origin main
   ```

2. **Ensure these files are in your repository**:
   - `render.yaml` - Render configuration
   - `Dockerfile.discourse` - Discourse container
   - `Dockerfile.landing` - Landing page container
   - `ai_service/Dockerfile` - AI service container
   - All plugin files in `plugins/` directory

### Step 2: Connect to Render

1. **Go to [Render Dashboard](https://dashboard.render.com)**
2. **Click "New +" → "Blueprint"**
3. **Connect your GitHub account**
4. **Select your repository**: `circle-of-peers`
5. **Click "Connect"**

### Step 3: Configure Environment Variables

In Render Dashboard, go to **Environment** tab and add:

#### Required Variables
```bash
# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key_here

# Discourse API
DISCOURSE_API_KEY=your_discourse_api_key_here

# Email Configuration
SMTP_HOST=smtp.circleofpeers.net
SMTP_PORT=587
SMTP_USERNAME=your_smtp_username
SMTP_PASSWORD=your_smtp_password

# Application Settings
DISCOURSE_HOSTNAME=circleofpeers.net
CDN_URL=https://cdn.circleofpeers.net
```

#### Auto-Generated Variables
```bash
# These will be auto-generated by Render
POSTGRES_HOST=your_postgres_host
POSTGRES_USER=discourse
POSTGRES_PASSWORD=auto_generated
REDIS_HOST=your_redis_host
SECRET_KEY_BASE=auto_generated
```

### Step 4: Deploy Services

Render will automatically create these services from `render.yaml`:

1. **cop-discourse** - Main forum platform
2. **cop-ai-service** - Content moderation service
3. **cop-landing-page** - Marketing landing page
4. **cop-postgres** - PostgreSQL database
5. **cop-redis** - Redis cache

### Step 5: Configure Custom Domain (Optional)

1. **In Render Dashboard**, go to your main service
2. **Click "Settings" → "Custom Domains"**
3. **Add your domain**: `circleofpeers.net`
4. **Update DNS** with Render's provided records
5. **SSL certificate** will be auto-generated

## 🔧 Service Configuration

### Discourse Service
- **URL**: `https://circleofpeers.net`
- **Health Check**: `/health`
- **Auto Deploy**: Enabled
- **Environment**: Production

### AI Service
- **URL**: `https://ai.circleofpeers.net`
- **Health Check**: `/health`
- **Auto Deploy**: Enabled
- **Environment**: Production

### Landing Page
- **URL**: `https://landing.circleofpeers.net`
- **Health Check**: `/health`
- **Auto Deploy**: Enabled

## 📊 Monitoring & Logs

### Access Logs
1. **Render Dashboard** → Your Service → **Logs**
2. **Real-time logs** with filtering
3. **Error tracking** and alerts

### Health Monitoring
- **Automatic health checks** every 30 seconds
- **Uptime monitoring** with alerts
- **Performance metrics** in dashboard

### Database Monitoring
- **PostgreSQL metrics** in Render dashboard
- **Connection pooling** automatically configured
- **Backup management** built-in

## 🔄 Deployment Workflow

### Development Workflow
```bash
# 1. Make changes locally
git add .
git commit -m "Add new feature"

# 2. Push to GitHub
git push origin main

# 3. Render automatically deploys
# Check deployment status in Render dashboard
```

### Staging Environment
1. **Create a new branch** for testing
2. **Push to GitHub**: `git push origin staging`
3. **Create staging service** in Render
4. **Test thoroughly** before merging to main

### Production Deployment
1. **Merge to main**: `git merge staging`
2. **Push to GitHub**: `git push origin main`
3. **Render auto-deploys** to production
4. **Monitor deployment** in dashboard

## 🛠️ Troubleshooting

### Common Issues

#### Service Won't Start
```bash
# Check logs in Render dashboard
# Common causes:
# - Missing environment variables
# - Database connection issues
# - Port conflicts
```

#### Database Connection Issues
```bash
# Verify environment variables:
# - POSTGRES_HOST
# - POSTGRES_USER
# - POSTGRES_PASSWORD
# - DATABASE_URL
```

#### Plugin Issues
```bash
# Check Discourse logs
# Verify plugin files are copied correctly
# Ensure plugin permissions are set
```

### Debug Commands
```bash
# Access service logs
# Render Dashboard → Service → Logs

# Check service health
curl https://your-service.onrender.com/health

# Test database connection
# Use Render's built-in database tools
```

## 📈 Scaling & Performance

### Auto Scaling
- **Enable auto-scaling** in service settings
- **Set minimum/maximum instances**
- **Configure scaling rules**

### Performance Optimization
- **Enable CDN** for static assets
- **Configure caching** headers
- **Optimize database queries**
- **Use connection pooling**

### Cost Optimization
- **Start with free tier** for testing
- **Upgrade only when needed**
- **Monitor usage** in dashboard
- **Use appropriate instance sizes**

## 🔒 Security

### Environment Variables
- **Never commit secrets** to GitHub
- **Use Render's environment variables**
- **Rotate keys regularly**

### SSL/TLS
- **Automatic HTTPS** certificates
- **Force HTTPS** redirects
- **Secure headers** configuration

### Database Security
- **IP allowlisting** for databases
- **Encrypted connections**
- **Regular backups**

## 📋 Deployment Checklist

### Before Deployment
- [ ] All code pushed to GitHub
- [ ] Environment variables configured
- [ ] Database migrations ready
- [ ] SSL certificates configured
- [ ] Domain DNS updated
- [ ] Monitoring alerts set up

### After Deployment
- [ ] Health checks passing
- [ ] All services responding
- [ ] Database connections working
- [ ] Email sending properly
- [ ] AI service responding
- [ ] Landing page accessible
- [ ] SSL certificates valid
- [ ] Performance acceptable

### Post-Deployment
- [ ] Test user registration
- [ ] Test content moderation
- [ ] Test billing integration
- [ ] Monitor error logs
- [ ] Set up backup verification
- [ ] Configure monitoring alerts

## 🎯 Next Steps

### Immediate Actions
1. **Set up GitHub repository**
2. **Configure Render account**
3. **Deploy staging environment**
4. **Test all functionality**
5. **Configure production domain**

### Ongoing Maintenance
1. **Monitor performance metrics**
2. **Update dependencies regularly**
3. **Backup verification**
4. **Security updates**
5. **Feature deployments**

### Advanced Features
1. **Set up CI/CD pipelines**
2. **Configure staging environment**
3. **Implement blue-green deployments**
4. **Add comprehensive monitoring**
5. **Set up disaster recovery**

## 📞 Support

### Render Support
- **Documentation**: [docs.render.com](https://docs.render.com)
- **Community**: [community.render.com](https://community.render.com)
- **Status**: [status.render.com](https://status.render.com)

### GitHub Integration
- **GitHub Actions**: For additional CI/CD
- **GitHub Pages**: For documentation
- **GitHub Issues**: For bug tracking

---

**🎉 Your Circle of Peers platform is now ready for production deployment on Render!**

The combination of GitHub + Render provides a robust, scalable, and maintainable infrastructure for your platform. 